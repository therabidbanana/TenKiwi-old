<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>TenKiwi</title>
<script src="http://ajax.microsoft.com/ajax/jquery/jquery-1.4.2.min.js"></script>
<script>
var pages={
	"#Intro": [{"What's TenKiwi?":"<p>TenKiwi is your very own javascript+html powered wiki.</p>"},{"What can it do?":"<p>You can create as many pages as you'd like, and fill them with whatever \"content\":[[Formatting]] suits your fancy. All of your changes are saved locally, acting like your very own private wiki that doesn't require any extra software to run. Use it to store notes, links or whatever else might suit your fancy.</p>"}],
	"#Credits":[{"Who's Responsible?":"<p>TenKiwi was coded by David Haslem.</p>"}],
	"#Formatting":[{"Content Formatting":"<p>Content Formatting is easy in TenKiwi - **just try editing** _this page_ to see. You can link back to a page, like the [[Intro]] page, or to an external site like http://www.google.com , or even change it up and link to \"a page with special link text\":[[Formatting]], or even an \"external site\":http://www.google.com with special text.</p>"}],
	"#kiwi-header":[{"TenKiwi":"<nav><ul><li>[[Intro]]</li><li>[[Credits]]</li></ul></nav>"}],
	"#kiwi-footer":[{"All Pages":"%%pagelist%%"}]
};
var js=JSON.stringify,jp=JSON.parse,exec=document.execCommand;
var pagelist=["#Intro","#Credits","#Formatting"];
$(function(){
	var a = window.location.hash; a = (a ? a:'#Intro');
	doload(a);
	
	$('.t').live('click', bc);
	$.each(
		{'InsertUnorderedList':false},
		function(i,a){$('#bar').append($('<button class="t blue">'+i+'</button>').data('b',a))});
	$('.container a').live('click', linked);
	var p = $('.q');
	
	p.focus(function(){
		editable($(this),true);
	});
	p.blur(function(){editable($(this),false)});
	$(window).bind('hashchange', function(){ doload(location.hash); return false}).hashchange();
});
function linked(){
	var a = $(this); 
	var b=a.attr('href');
	if(b.search(/^http:/)===-1){
		if($('body').hasClass('go')) confirm('Save your changes before navigating away?') ? edit_off(true) : edit_off(false);
		window.location=b; 
	}
	else {this.target='_blank';return true};
}
function doload(a){
	b=jp(localStorage.getItem('pagelist'));
	pagelist=b?b:pagelist;
	myload('#kiwi-header', $('header.x'));
	myload(a, $('article.x'));
	myload('#kiwi-footer', $('footer.x'));
}
function myload(a,b){
	var c = localStorage.getItem(a);
	if(!c){
		c=pages[a]? pages[a]: jp("[{\""+a.substr(1)+"\":\"<p>This is a new page</p>\"}]");
	}else c=jp(c);
	b.empty();
	$.each(c,function(i,x){$.each(x,function(j,y){
		b.append('<section><header class="q"><h1>'+j+'</h1></header><section class="q">'+y+'</section></section>');
	})});
	supermagic(b);
	b.attr('id',a.substr(1));
}
function magic(a){
	a=a.replace(/%%pagelist%%/g, "<ul>"+$.map(pagelist, function(x){ return "<li>[["+x.substr(1)+"]]</li>"}).join('\n')+"</ul>");
	a=a.replace(/\*\*([^*]+?)\*\*/g, '<strong>$1</strong>');
	a=a.replace(/\b_([^_]+?)_\b/g, '<em>$1</em>');
	a=a.replace(/\[\[([^"]+?)\]\]/g, '<a href="#$1">$1</a>');
	a=a.replace(/`([^`]+?)`/g, '<code>$1</code>');
	a=a.replace(/(https?:\/\/[^\s"]+)/g, '<a href="$1">$1</a>');
	a=a.replace(/<a href="([^"]+?)([,\.\?])">(.+?)\2<\/a>/g, '<a href="$1">$1</a>$2');
	a=a.replace(/"([^"]+?)":<a href="([^"]+?)">(.+?)<\/a>/g, '<a href="$2">$1</a>');
	return a;
}
function supermagic(a){
	a.data("unmagic",a.html());
	a.html(magic(a.html()));
	$('a',a).each(function(i,x){
		x=$(x);
		if(x.attr('href').match(/^#/)){
			$.inArray(x.attr('href'),pagelist)===-1?x.addClass('broken'):x.removeClass('broken');
		}
	})
}
function unsupermagic(a){
	a=a.closest('.x');
	a.html(a.data("unmagic"));
}
function dosave(a){
	var b=[],c="#";
	a=a.closest('.x');
	c=c+a.attr('id');
	a.children('section').each(function(i,c){
		b.push("{"+js($(c).children('header').text())+":"+ js($(c).children('section').html())+"}")
	});
	b="["+b.join(',')+"]";
	localStorage.setItem(c,b);
	if($.inArray(c,pagelist) === -1){
		pagelist.push(c);
		localStorage.setItem('pagelist',js(pagelist));
	}
	supermagic(a);
}
function editable(a,b){a.toggleClass('e');};
function bc(){
	var a=$(this).text(),b=$(this).data('b');
	document.execCommand(a,null,b?prompt(b):b);
}
function edit_on(){
	$('body').addClass('go');unsupermagic($('article'));$('article .q').attr('contenteditable', true);
}
function edit_off(a){
	$('body').removeClass('go');$('article .q').attr('contenteditable', false);
	if(a) dosave($('article'));
	else doload(window.location.hash,$('article.x'));
}
</script>
<script type="text/javascript" src="http://use.typekit.com/zxq5eee.js"></script>
<script type="text/javascript">try{Typekit.load();}catch(e){}</script>
<style>
body{background:#486805 url(./stripe.png);font: 14px/1.5 'Lucida Grande', Lucida, Verdana, sans-serif;margin:0;padding:0;}
a.broken{color:#833;}
a.broken:after{content:"?";}
.container{width: 80%;background: #82B51B;margin:40px auto;-moz-border-radius:8px;-webkit-border-radius:8px;border-radius:8px; -webkit-box-shadow: 0 0 3px #240;-moz-box-shadow: 0 0 3px #240;box-shadow: 0 0 3px #240;}
.container>header{ text-align: center;}
.container>header h1{font-family: "good-kitty-1","good-kitty-2",cursive;font-size:60px;margin:10px 20px;-webkit-transform:rotate(-3deg);-moz-transform:rotate(-3deg);color:#fff;float:left;text-shadow: 0px 1px 3px #486805;}
.container>article{clear:both;margin-top:10px;background:#fff;padding:20px;-moz-border-radius:8px;-webkit-border-radius:8px;border-radius:8px;}
h1{margin:0.25em 0; font-size:2em;}
p,article li{font-size:1.3em;}
nav{float:left;margin-top:40px;}
nav ul{list-style:none;margin:0;padding:0;}
nav li{display:inline-block; margin: 0 10px;}
nav li a{color:#fff; font-size:1.5em; text-decoration:none;}
nav li a:hover{border-bottom:4px solid white;}
footer a, footer{color:#240;}
footer{padding: 1em;}
footer:after{clear:both; content: ".";display: block;height: 0;visibility:hidden;}
footer li{width: 33%; float:left;}
section,article{display:block;}
#bar,#bar2{background:rgba(36, 10, 5, 0.9);#240A05;text-align:left;padding: 16px 20px 8px;position:fixed;z-index:20;top:-8px;left:60px;-moz-border-radius:8px;-webkit-border-radius:8px;border-radius:8px;}
#bar{display:none;}
#bar div{float:left;margin-right: 20px;}
.go #bar{display:block;}
.go #bar2{display:none;}
article section>header{border-bottom: 2px solid #ccc; margin:0 0 10px;}
article section>header h1{}
article section section{border:1px dotted transparent;margin:0 0 15px;}
.go article section section{border:1px dashed #aaa;}
.go article section>header h1{background:#ded;}
.go section.e{border:1px solid #7f7;}
button{-moz-border-radius:5px;-webkit-border-radius:5px;border-radius:5px;background:#82B51B;color:#fff;padding:5px 9px;font-size:0.9em;font-weight:bold;border:0;-moz-box-shadow: 0 1px 3px rgba(0,0,0,0.25); -webkit-box-shadow: 0 1px 3px rgba(0,0,0,0.25); box-shadow: 0 1px 3px rgba(0,0,0,0.25); border-bottom: 1px solid rgba(0,0,0,0.25); position: relative; cursor: pointer;text-shadow: 0 -1px 1px rgba(0,0,0,0.25); font-weight: bold; display: inline-block;}
button:hover{background:#72A50B;}
code{font: 13px Monaco,"Courier New", Courier, mono;}
p code{background:#eef; padding:3px;border: 1px solid #dde;color:#222;}
button.yellow{background:#ffb515}
button.orange{background:#ff5c00}
button.red{background:#e33100}
button.blue{background:#2daebf}
button.yellow:hover{background:#efa505}
button.orange:hover{background:#ef4c00}
button.red:hover{background:#d32100}
button.blue:hover{background:#1d9eaf}
</style>
</head>
<body>
	<div id="bar2"><button onclick="edit_on()">Edit</button></div>
	<div id="bar"><div><button onclick="edit_off(true)">Done editing</button><button class="red" onclick="if(confirm('Are you sure you want to discard your changes?')) edit_off(false)">Discard Changes</button></div></div>
	<div class="container tk-calluna">
		<header class="x"></header>
		<article class="x"><p>If you don't see any content here, there was a Javascript issue. It's possible you're not using a very modern browser - TenKiwi relies on a lot of cutting edge features. Try Chrome 5 or Firefox 3.6.</p></article>
		<footer class="x"></footer>
	</div>
</body>
</html>